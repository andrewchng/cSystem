/**
 * ngScrollable - Superamazing scrollbars for AngularJS
 * @version 0.2.0 - built on 2015-07-20
 * @link https://echa.github.io/ng-scrollable/
 * @license MIT License, Copyright (c) 2015 Alexander Eichhorn <alex@kidtsunami.com>
 */
angular.module("ngScrollable",[]).directive("ngScrollable",["$injector",function(a){"use strict";var b=a.get("$document"),c=a.get("$timeout"),d=a.get("$window"),e=a.get("$parse"),f=a.get("$$rAF"),g=angular.extend,h=angular.element,i=(angular.isDefined,"undefined"!=typeof d.ontouchstart),j="transform";["webkit","moz","o","ms"].every(function(a){var c=a+"Transform",d=b.find("body").eq(0);return"undefined"!=typeof d[0].style[c]?(j=c,!1):!0});var k={id:0,scrollX:"bottom",scrollY:"right",scrollXSlackSpace:0,scrollYSlackSpace:0,scrollXAlways:!1,scrollYAlways:!1,usePadding:!1,wheelSpeed:1,minSliderLength:10,useBothWheelAxes:!1,useKeyboard:!0,updateOnResize:!0,kineticTau:325};return{restrict:"A",transclude:!0,template:"<div class=\"scrollable\"><div class=\"scrollable-content\" ng-transclude></div><div class='scrollable-bar scrollable-bar-x'><div class='scrollable-slider'></div></div><div class='scrollable-bar scrollable-bar-y'><div class='scrollable-slider'></div></div></div>",link:function(a,l,m){var n,o,p,q=g({},k,a.$eval(m.ngScrollable)),r=h(l.children()[0]),s={window:h(d),el:r,content:h(r.children()[0]),barX:h(r.children()[1]),barY:h(r.children()[2]),sliderX:h(h(r.children()[1]).children()[0]),sliderY:h(h(r.children()[2]).children()[0])},t=!1,u=!1,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=null,G=null,H=null,I=null,J=!1,K=!1,L=!1,M={},N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=function(a){return a.toFixed(3)+"px"},W=function(a,b,c){return Math.max(b,Math.min(a,c))},X=function(){var a=v-3;t?(B=Math.max(q.minSliderLength,parseInt(a*a/x,10)),C=parseInt(A*(a-B)/(x-a),10),C>=a-B?C=a-B:0>C&&(C=0),s.sliderX[0].style[j]="translate3d("+V(C)+",0,0)",s.sliderX[0].style.width=V(B)):(B=C=0,s.sliderX[0].style[j]="translate3d(0,0,0)",s.sliderX[0].style.width="0")},Y=function(){var a=w-3;u?(D=Math.max(q.minSliderLength,parseInt(a*a/y,10)),E=parseInt(z*(a-D)/(y-a),10),E>=a-D?E=a-D:0>E&&(E=0),s.sliderY[0].style[j]="translate3d(0,"+V(E)+",0)",s.sliderY[0].style.height=V(D)):(E=D=0,s.sliderY[0].style[j]="translate3d(0,0,0)",s.sliderY[0].style.height="0")},Z=function(){var a=q.scrollXAlways,b={left:0,width:V(v),display:t||a?"inherit":"none"};switch(q.scrollX){case"bottom":b.bottom=0,s.content[t||a?"addClass":"removeClass"]("scrollable-bottom"),s.barX[t||a?"addClass":"removeClass"]("scrollable-bottom");break;case"top":b.top=0,s.content[t||a?"addClass":"removeClass"]("scrollable-top"),s.barX[t||a?"addClass":"removeClass"]("scrollable-top")}s.barX.css(b),s.sliderX[0].style.display=t?"inherit":"none"},$=function(){var a=q.scrollYAlways,b={top:0,height:V(w),display:u||a?"inherit":"none"};switch(q.scrollY){case"right":b.right=0,s.content[u||a?"addClass":"removeClass"]("scrollable-right"),s.barY[u||a?"addClass":"removeClass"]("scrollable-right");break;case"left":b.left=0,s.content[u||a?"addClass":"removeClass"]("scrollable-left"),s.barY[u||a?"addClass":"removeClass"]("scrollable-left")}s.barY.css(b),s.sliderY[0].style.display=u?"inherit":"none"},_=function(b,c){z=W(c,0,y-w),A=W(b,0,x-v),s.content[0].style[j]="translate3d("+V(-A)+","+V(-z)+",0)",M.spyX&&M.spyX(a,parseInt(A,10)),M.spyY&&M.spyY(a,parseInt(z,10))},aa=function(a){t&&(_(a,z),X())},ba=function(a){u&&(_(A,a),Y())},ca=function(b,c){v=q.usePadding?s.el[0].clientWidth:s.el[0].offsetWidth,w=q.usePadding?s.el[0].clientHeight:s.el[0].offsetHeight,x=s.content[0].scrollWidth,y=s.content[0].scrollHeight,"none"!==q.scrollX&&x>v+q.scrollXSlackSpace?t=!0:(t=!1,aa(0)),"none"!==q.scrollY&&y>w+q.scrollYSlackSpace?u=!0:(u=!1,ba(0)),Z(),$(),X(),Y(),c||a.$broadcast("scrollable.dimensions",v,w,x,y,q.id)},da=function(a,b){return a.stopPropagation(),b&&a.preventDefault(),!1},ea=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageY:a.pageY},fa=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageX:a.pageX},ga=function(){var a,b,c,d;a=Date.now(),b=a-o,o=a,c=A-P,P=A,d=1e3*c/(1+b),N=.8*d+.2*N,c=z-T,T=z,d=1e3*c/(1+b),R=.8*d+.2*R},ha=function(){var a,b;O&&(a=Date.now()-o,b=-O*Math.exp(-a/q.kineticTau),b>.5||-.5>b?(aa(Q+b),f(ha)):aa(Q))},ia=function(){var a,b;S&&(a=Date.now()-o,b=-S*Math.exp(-a/q.kineticTau),b>.5||-.5>b?(ba(U+b),f(ia)):ba(U))},ja=function(a){return G=fa(a),F=A,J=!0,N=O=0,P=A,p||(p=c(ga,100)),s.el.addClass("active"),da(a,!0)},ka=function(a){if(J){var b=fa(a)-G,c=i?-b:parseInt(b*(x-v)/(v-B),10);return aa(F+c),da(a,!0)}},la=function(a){J&&(J=!1,s.el.removeClass("active"),F=G=null),p&&(c.cancel(p),p=null),(N>10||-10>N)&&(O=.8*N,Q=Math.round(A+O),o=Date.now(),f(ha))},ma=function(a){return I=ea(a),H=z,K=!0,R=S=0,T=z,p||(p=c(ga,100)),s.el.addClass("active"),da(a,!0)},na=function(a){if(K){var b=ea(a)-I,c=i?-b:parseInt(b*(y-w)/(w-D),10);return ba(H+c),da(a,!0)}},oa=function(a){K&&(K=!1,s.el.removeClass("active"),H=I=null),p&&(c.cancel(p),p=null),(R>10||-10>R)&&(S=.8*R,U=Math.round(z+S),o=Date.now(),f(ia))},pa=function(b){var c=parseInt(B/2,10),d=b.clientX-s.barX[0].getBoundingClientRect().left-c,e=v-B,f=W(d/e,0,1);aa((x-v)*f),a.$digest()},qa=function(b){var c=parseInt(D/2,10),d=b.clientY-s.barY[0].getBoundingClientRect().top-c,e=w-D,f=W(d/e,0,1);ba((y-w)*f),a.$digest()},ra=function(){L=!0},sa=function(){L=!1},ta=function(c){var d=0,e=0,f=30;if(!(!L||b[0].activeElement.isContentEditable||c.altKey||c.ctrlKey||c.metaKey)){switch(c.which){case 37:d=-f;break;case 38:e=f;break;case 39:d=f;break;case 40:e=-f;break;case 33:e=w;break;case 32:case 34:e=-w;break;case 35:u&&!t?e=-y:d=w;break;case 36:u&&!t?e=y:d=-w;break;default:return}ba(z-e),aa(A+d),c.preventDefault(),a.$digest()}},ua=function(b){b=b.originalEvent||b;var d=b.deltaX*q.wheelSpeed,e=b.deltaY*q.wheelSpeed;s.el.addClass("active"),c.cancel(n),n=c(function(){s.el.removeClass("active")},500),q.useBothWheelAxes?u&&!t?ba(e?z+e:z+d):t&&!u&&aa(d?A+d:A+e):(ba(z+e),aa(A+d)),da(b,!0),a.$digest()},va=function(){q.updateOnResize&&s.window.on("resize",ca),"none"!==q.scrollX&&(s.sliderX.on("click",da),s.barX.on("click",pa),i?(s.el.on("touchstart",ja),s.el.on("touchmove",ka),s.el.on("touchend",la)):(s.sliderX.on("mousedown",ja),b.on("mousemove",ka),b.on("mouseup",la))),"none"!==q.scrollY&&(s.sliderY.on("click",da),s.barY.on("click",qa),i?(s.el.on("touchstart",ma),s.el.on("touchmove",na),s.el.on("touchend",oa)):(s.sliderY.on("mousedown",ma),b.on("mousemove",na),b.on("mouseup",oa))),i||s.el.on("wheel",ua),q.useKeyboard&&!i&&(s.el.on("mouseenter",ra),s.el.on("mouseleave",sa),b.on("keydown",ta))},wa=function(){q.updateOnResize&&s.window.off("resize",ca),s.sliderX.off("click",da),s.barX.off("click",pa),s.sliderY.off("click",da),s.barY.off("click",qa),i?(s.el.off("touchstart",ja),s.el.off("touchmove",ka),s.el.off("touchend",la),s.el.off("touchstart",ma),s.el.off("touchmove",na),s.el.off("touchend",oa)):(s.sliderX.off("mousedown",ja),b.off("mousemove",ka),b.off("mouseup",la),s.sliderY.off("mousedown",ma),b.off("mousemove",na),b.off("mouseup",oa),q.useKeyboard&&(s.el.off("mouseenter",ra),s.el.off("mouseleave",sa),b.off("keydown",ta)),s.el.off("wheel",ua))};a.$on("content.reload",function(a,b){wa(),c(function(){s.el=h(l.children()[0]),s.content=h(s.el.children()[0]),va(),ca(a,b)})}),a.$on("content.changed",function(a,b,d){b=b||100,c(function(){ca(a,d)},b),a.preventDefault()}),a.$on("scrollable.scroll.left",function(){c(function(){aa(0)})}),a.$on("scrollable.scroll.right",function(){c(function(){aa(x)})}),a.$on("scrollable.scroll.top",function(){c(function(){ba(0)})}),a.$on("scrollable.scroll.bottom",function(){c(function(){ba(y)})}),a.$on("$destroy",function(){c.cancel(n),wa()}),va(),ca(),angular.forEach(["spyX","spyY"],function(b){m[b]&&(M[b]=e(m[b]).assign,a.$watch(m[b],function(a){switch(b){case"spyX":aa(a);break;case"spyY":ba(a)}}))})}}}]);